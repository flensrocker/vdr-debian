#!/usr/bin/make -f

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

CXXFLAGS = $(shell dpkg-buildflags --get CPPFLAGS)
CXXFLAGS += $(shell dpkg-buildflags --get CXXFLAGS)

export VIDEODIR = /var/lib/video
export LIBDIR = /usr/lib/vdr/plugins

%:
	dh $@

override_dh_auto_build:
	dh_auto_build
	$(CC) $(CPPFLAGS) $(CFLAGS) $(LDFLAGS) -o debian/vdr-shutdown.wrapper debian/vdr-shutdown-wrapper.c
	$(CC) $(CPPFLAGS) $(CFLAGS) $(LDFLAGS) -o debian/ctvdrwrapper debian/ctvdrwrapper.c

override_dh_auto_clean:
	dh_auto_clean
	rm -f debian/vdr-shutdown.wrapper
	rm -f debian/ctvdrwrapper
	rm -f debian/patchinfo

override_dh_auto_install:
	dh_auto_install -- PREFIX=/usr

override_dh_install: patchinfo
	dh_install --fail-missing -Xlibvdr-epgtableid0.so
	install -D -m 755 newplugin debian/vdr-dev/usr/bin/vdr-newplugin
	echo -n "vdr:Provides=" >> debian/vdr.substvars
	cat debian/abi-version >> debian/vdr.substvars
	for example in hello osddemo pictures servicedemo skincurses status svdrpdemo rcu; do \
	    install -D PLUGINS/src/$$example/README debian/vdr-plugin-examples/usr/share/doc/vdr-plugin-examples/README.$$example; \
	done


override_dh_installchangelogs:
	dh_installchangelogs -pvdr HISTORY
	dh_installchangelogs -pvdr-plugin-dvbsddevice PLUGINS/src/dvbsddevice/HISTORY
	dh_installchangelogs -pvdr-plugin-dvbhddevice PLUGINS/src/dvbhddevice/HISTORY
	dh_installchangelogs -pvdr-plugin-examples
	dh_installchangelogs -pvdr-dev

patchinfo:
	sh debian/extract-patchinfo >debian/patchinfo

check-patches:
	python debian/patchcheck.py -c $(PATCHCHECKOPTION)

accept-patches:
	python debian/patchcheck.py -u $(PATCHCHECKOPTION)